#!/usr/bin/python3
import nmap
from subprocess import check_output
import shlex

scanner = nmap.PortScanner()

print("Welcome to the nmap automation tool")
print("Note: This tool is designed to help pentester automate the process of a common nmap scan. Please use it responsibily. I am not responsible any for misuse of this script.")
print("This script runs a nmap scan on the ip address given and then searches searchsploit for any available exploits. Please ensure you have permision to scan that IP Address.")
print("Script made by kshah1911")
print("<------------------------------------>")

ip_address = input("IP Address to scan: ")
print("Target set to "+ip_address, "\nAgain, make sure you have permission. Most common posts will be scanned\n")

input("Press enter to begin scan:")

output = scanner.scan(ip_address,None, '-v -sV -F')
ports = output["scan"][ip_address]["tcp"]
port_details = []
for port_no in ports: 
    port = ports[port_no]
    if port["state"] == "open":
        details = port["name"] +" "+ port["product"] +" "+ port["version"] +" "+ port["extrainfo"]
        port_details.append(details)

for detail in port_details:
    cmd = "searchsploit " + detail
    output = check_output(shlex.split(cmd)).decode('utf-8')
    if output.strip() != """Exploits: No Results
Shellcodes: No Results""":
        print("*********** VULNERABILITY FOUND IN " + detail + "**************")
        print(output)

